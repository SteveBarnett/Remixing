{% include header.html title=page.title %}

{{ content | markdownify }}

<p>Below is an overview of the topics in <a href="/{{ page.currentcategory }}/">{{ page.currentcategory | capitalize }}</a>.</p>

{%- assign sortedtags = site.tags | sort -%}

<h2>The topics</h2>

{%- capture listoftags -%}
  {%- for tag in sortedtags -%}
    {%- assign currenttagname = tag[0] -%}
    , <span class="tagmoji">{{ site.data.tagmoji[currenttagname] }}</span>&nbsp;<a href="#{{ currenttagname }}">{{ currenttagname | capitalize }}</a>
  {%- endfor -%}
{%- endcapture -%}

{{ listoftags | remove_first: ", " }}.

<h2>The connections</h2>

<ul>
{%- for tag in sortedtags -%}

  {%- assign postsfilteredbycategory = tag[1] | where: "categories", page.currentcategory -%}
  {%- assign numberofpostsfilteredbycategory = postsfilteredbycategory | size -%}

  {%- unless numberofpostsfilteredbycategory == 0 -%}

    {%- assign tagsrelatedtothistag = "" -%}
    {%- assign currenttagname = tag[0] -%}

    <li id="{{ currenttagname }}">
      <span class="tagmoji">{{ site.data.tagmoji[currenttagname] }}</span>&nbsp;<a href="/thinking/#{{ currenttagname }}">{{ currenttagname | capitalize }}</a>

      <ul>

    {%- for post in postsfilteredbycategory -%}
      {%- for tagfortagrelation in post.tags -%}
        {%- unless tagfortagrelation == currenttagname -%}
          {%- assign tagsrelatedtothistag = tagsrelatedtothistag | append: ", " | append: tagfortagrelation -%}
        {%- endunless -%}
      {%- endfor -%}
    {%- endfor -%}

    {%- assign tagsrelatedtothistag = tagsrelatedtothistag | remove_first: ", " -%}
    {%- assign tagsrelatedtothistagarray = tagsrelatedtothistag | split: ", " -%}
    {%- assign tagsrelatedtothistagarray = tagsrelatedtothistagarray | uniq -%}
    {%- assign tagsrelatedtothistagarraysize = tagsrelatedtothistagarray | size -%}
    {%- assign tagsrelatedtothistagarray = tagsrelatedtothistagarray | sort_natural %}
    
    {%- unless tagsrelatedtothistagarraysize == 0 -%}
      {%- capture tagsrelatedtothistagstring -%}
          <p>Related:&nbsp;
        {%- for tagsrelatedtothistaglinks in tagsrelatedtothistagarray -%}
          , <span class="tagmoji">{{ site.data.tagmoji[tagsrelatedtothistaglinks] }}</span>&nbsp;<a href="#{{ tagsrelatedtothistaglinks }}">{{ tagsrelatedtothistaglinks | capitalize }}</a>
        {%- endfor -%}
        .</p>
      {%- endcapture -%}
      
      <li>
        {{ tagsrelatedtothistagstring | remove_first: ", " }}
      </li>
    {%- endunless -%}

    {%- assign postsfilteredbytheothercategory = tag[1] | where: "categories", page.othercategory -%}
    {%- assign numberofpostsfilteredbytheothercategory = postsfilteredbytheothercategory | size -%}

    {%- unless numberofpostsfilteredbytheothercategory == 0 -%}
    <li>
      <p>See also: <a href="/{{ page.othercategory }}/">{{ page.othercategory | capitalize }}</a> → <span class="tagmoji">{{ site.data.tagmoji[currenttagname] }}</span>&nbsp;<a href="/{{ page.othercategory }}/#{{ currenttagname }}">{{ currenttagname | capitalize }}</a>.</p>
    </li>
    {%- endunless -%}

    </ul>
  </li>
  {%- endunless -%}

{%- endfor -%}
</ul>

<p>See also: <a href="/{{ page.othercategory }}/">{{ page.othercategory | capitalize }}</a> → <a href="/{{ page.othercategory }}/topics/">Topics</a>.</p>


{% include footer.html %}
