{% include header.html title=page.title %}

{{ content | markdownify }}

{%- assign sortedtags = site.tags | sort -%}

<p>There's also <a href="/{{ page.currentcategory }}/topics/">a list of just the topics</a> and <a href="/{{ page.currentcategory }}/starred/">a list of just the starred items</a>.</p>

{%- for tag in sortedtags -%}

  {%- assign postsfilteredbycategory = tag[1] | where: "categories", page.currentcategory -%}
  {%- assign numberofpostsfilteredbycategory = postsfilteredbycategory | size -%}

  {%- unless numberofpostsfilteredbycategory == 0 -%}

    {%- assign tagsrelatedtothistag = "" -%}
    {%- assign currenttagname = tag[0] -%}

    <h2 id="{{ currenttagname }}"><span class="tagmoji">{{ site.data.tagmoji[currenttagname] }}</span> <a href="#{{ currenttagname }}">{%-
    if currenttagname == "TMWT" -%}
    {{ currenttagname }}
    {%- else -%}
    {{ currenttagname | capitalize }}
    {%- endif -%}</a></h2>

    <ul>
    {%- for post in postsfilteredbycategory -%}
      <li id="{{ post.title | truncatewords: 5 | slugify  }}">
        {% if post.star %}★ <strong>{% endif %}
        {{ post.title }}
      {% if post.star %}</strong>{% endif %}

        {%- assign numberoftags = post.tags | size -%}
        {%- if numberoftags > 1 -%}

          {%- capture tagsrelatedtothispost -%}
          &nbsp;Related:&nbsp;
          {%- for taginpost in post.tags -%}
            {%- unless taginpost == currenttagname -%}
              , <span class="tagmoji">{{ site.data.tagmoji[taginpost] }}</span>&nbsp;<a href="#{{ taginpost }}">{{ taginpost | capitalize }}</a>
            {%- endunless -%}
          {%- endfor -%}
          .
          {%- endcapture -%}
          {{ tagsrelatedtothispost | remove_first: ", " }}

        {%- endif -%}
      </li>

      {%- for tagfortagrelation in post.tags -%}
        {%- unless tagfortagrelation == currenttagname -%}
          {%- assign tagsrelatedtothistag = tagsrelatedtothistag | append: ", " | append: tagfortagrelation -%}
        {%- endunless -%}
      {%- endfor -%}

    {%- endfor -%}
    </ul>

    {%- assign tagsrelatedtothistag = tagsrelatedtothistag | remove_first: ", " -%}
    {%- assign tagsrelatedtothistagarray = tagsrelatedtothistag | split: ", " -%}
    {%- assign tagsrelatedtothistagarray = tagsrelatedtothistagarray | uniq -%}
    {%- assign tagsrelatedtothistagarraysize = tagsrelatedtothistagarray | size -%}

    {%- unless tagsrelatedtothistagarraysize == 0 -%}
      {%- capture tagsrelatedtothistagstring -%}
      <p>Related to {{ currenttagname | capitalize }}:&nbsp;
      {%- for tagsrelatedtothistaglinks in tagsrelatedtothistagarray -%}
        , <span class="tagmoji">{{ site.data.tagmoji[tagsrelatedtothistaglinks] }}</span>&nbsp;<a href="#{{ tagsrelatedtothistaglinks }}">{{ tagsrelatedtothistaglinks | capitalize }}</a>
      {%- endfor -%}
      .</p>
      {%- endcapture -%}
      {{ tagsrelatedtothistagstring | remove_first: ", " }}
    {%- endunless -%}

    {%- assign postsfilteredbytheothercategory = tag[1] | where: "categories", page.othercategory -%}
    {%- assign numberofpostsfilteredbytheothercategory = postsfilteredbytheothercategory | size -%}

    {%- unless numberofpostsfilteredbytheothercategory == 0 -%}
    <p>See also: <a href="/{{ page.othercategory }}/">{{ page.othercategory | capitalize }}</a> → <span class="tagmoji">{{ site.data.tagmoji[currenttagname] }}</span>&nbsp;<a href="/{{ page.othercategory }}/#{{ currenttagname }}">{{ currenttagname | capitalize }}</a>.</p>
    {%- endunless -%}

  {%- endunless -%}

{%- endfor -%}

{% include footer.html %}
